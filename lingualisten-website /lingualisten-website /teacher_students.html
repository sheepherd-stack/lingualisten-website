<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Student Management Â· LinguaListen</title>

<style>
  body { font-family: Arial; background: #fff5eb; padding: 20px; }
  h2 { color: #ff7e2b; }
  
  .box {
    background: white;
    padding: 15px;
    border-radius: 12px;
    border: 2px solid #ff7e2b;
    max-width: 480px;
    margin-bottom: 25px;
  }

  input {
    padding: 10px;
    width: 90%;
    margin: 5px 0;
    border-radius: 7px;
    border: 1px solid #ccc;
  }

  button {
    margin-top: 10px;
    padding: 12px;
    background: #ff7e2b;
    border: none;
    color: white;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
  }

  button:hover { background: #ff9c57; }

  .student-item {
    border-bottom: 1px solid #ddd;
    padding: 8px 0;
  }
</style>

</head>
<body>

<h2>ğŸ‘¥ Student Accounts Management</h2>

<!-- æ·»åŠ å­¦ç”Ÿ -->
<div class="box">
  <h3>â• Add Student</h3>

  <input id="new_user" placeholder="Username ç”¨æˆ·å">
  <input id="new_pass" placeholder="Password å¯†ç ">
  <input id="new_email" placeholder="Email é‚®ç®±ï¼ˆå¯é€‰ï¼‰">
  <input id="new_phone" placeholder="Phone ç”µè¯ï¼ˆå¯é€‰ï¼‰">

  <button onclick="addStudent()">Add æ·»åŠ </button>

  <p id="add_result"></p>
</div>

<!-- å­¦ç”Ÿåˆ—è¡¨ -->
<div class="box">
  <h3>ğŸ“‹ Student List å­¦ç”Ÿåˆ—è¡¨</h3>
  <div id="student_list">Loading...</div>
</div>

<script>
const API = "https://lingualisten-backend.onrender.com";

// åŠ è½½å­¦ç”Ÿåˆ—è¡¨
async function loadStudents() {
  const res = await fetch(API + "/students");
  const data = await res.json();

  const box = document.getElementById("student_list");
  box.innerHTML = "";

  Object.keys(data).forEach(name => {
    const item = document.createElement("div");
    item.className = "student-item";

    item.innerHTML = `
      <b>${name}</b><br>
      ğŸ“§ ${data[name].email || "â€”"}<br>
      ğŸ“± ${data[name].phone || "â€”"}<br>
      <button onclick="resetPass('${name}')">ğŸ”‘ Reset Password</button>
      <button onclick="deleteStudent('${name}')">ğŸ—‘ Delete</button>
    `;
    box.appendChild(item);
  });
}

// æ·»åŠ å­¦ç”Ÿ
async function addStudent() {
  const u = document.getElementById("new_user").value.trim();
  const p = document.getElementById("new_pass").value.trim();
  const email = document.getElementById("new_email").value.trim();
  const phone = document.getElementById("new_phone").value.trim();

  if (!u || !p) {
    document.getElementById("add_result").innerHTML = "âŒ ç”¨æˆ·åå’Œå¯†ç å¿…å¡«";
    return;
  }

  const res = await fetch(API + "/students/add", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: u, password: p, email, phone })
  });

  const text = await res.text();
  document.getElementById("add_result").innerHTML = text;

  loadStudents();
}

// é‡ç½®å¯†ç 
async function resetPass(username) {
  const newPass = prompt("è¯·è¾“å…¥æ–°å¯†ç  / Enter new password:");

  if (!newPass) return;

  const res = await fetch(API + "/students/reset", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, new_password: newPass })
  });

  alert(await res.text());
}

// åˆ é™¤å­¦ç”Ÿ
async function deleteStudent(username) {
  if (!confirm("ç¡®å®šåˆ é™¤è¿™ä¸ªå­¦ç”Ÿå—ï¼Ÿ")) return;

  const res = await fetch(API + "/students/delete", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username })
  });

  alert(await res.text());
  loadStudents();
}

// åˆå§‹åŒ–åŠ è½½
loadStudents();

</script>

</body>
</html>
