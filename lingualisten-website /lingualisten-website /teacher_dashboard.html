<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Teacher Dashboard</title>

  <style>
    body {
      font-family: Arial;
      background: #fffdf7;
      padding: 20px;
    }
    h2 {
      color: #ff8c3a;
    }
    .box {
      background: white;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    button {
      padding: 6px 12px;
      background: #ff8c3a;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 8px;
    }
  </style>
</head>
<body>

<h2>ğŸ§‘â€ğŸ« æ•™å¸ˆä»»åŠ¡ç®¡ç†ï¼ˆTeacher Dashboardï¼‰</h2>

<!-- =======================
     SECTION Aï¼šææ–™åˆ—è¡¨
======================= -->
<div class="box">
  <h3>ğŸ“˜ å·²ä¸Šä¼ ææ–™ï¼ˆMaterialsï¼‰</h3>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>æ ‡é¢˜</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="materialList"></tbody>
  </table>
</div>


<!-- =======================
     SECTION Bï¼šä»»åŠ¡åˆ—è¡¨
======================= -->
<div class="box">
  <h3>ğŸ¯ å·²åˆ›å»ºä»»åŠ¡ï¼ˆTasksï¼‰</h3>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>æ ‡é¢˜</th>
        <th>ææ–™ID</th>
        <th>æ¨¡å¼</th>
        <th>éš¾åº¦</th>
      </tr>
    </thead>
    <tbody id="taskList"></tbody>
  </table>
</div>


<script>
const API = "https://lingualisten-backend.onrender.com";

/* ===============================
   è·å–ææ–™åˆ—è¡¨
=============================== */
async function loadMaterials() {
  let res = await fetch(API + "/materials/all");
  let data = await res.json();

  let box = document.getElementById("materialList");
  box.innerHTML = "";

  data.forEach(m => {
    box.innerHTML += `
    <tr>
      <td>${m.id}</td>
      <td>${m.title}</td>
      <td>
        <button onclick="createTask(${m.id})">åˆ›å»ºä»»åŠ¡</button>
      </td>
    </tr>`;
  });
}


/* ===============================
   è·å–ä»»åŠ¡åˆ—è¡¨
=============================== */
async function loadTasks() {
  let res = await fetch(API + "/tasks/all");
  let data = await res.json();

  let box = document.getElementById("taskList");
  box.innerHTML = "";

  data.forEach(t => {
    box.innerHTML += `
    <tr>
      <td>${t.id}</td>
      <td>${t.title}</td>
      <td>${t.material_id}</td>
      <td>${t.modes.join(", ")}</td>
      <td>${t.difficulty}</td>
    </tr>`;
  });
}


/* ===============================
   åˆ›å»ºä»»åŠ¡ï¼ˆç»™æŸä¸ªææ–™ï¼‰
=============================== */
async function createTask(material_id) {
  let title = prompt("è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜ Title:");
  if (!title) return;

  let res = await fetch(API + "/tasks", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      title: title,
      material_id: material_id,
      modes: ["dictation", "shadowing", "retell", "summary"],
      difficulty: "easy"
    })
  });

  if (res.ok) {
    alert("ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼");
    loadTasks(); // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
  } else {
    alert("åˆ›å»ºä»»åŠ¡å¤±è´¥");
  }
}


/* ===============================
   åˆå§‹åŒ–
=============================== */
loadMaterials();
loadTasks();

</script>

</body>
</html>


<!-- =====================================
     SECTION Cï¼šå­¦ç”Ÿè´¦å·ç®¡ç†
====================================== -->
<div class="box">
  <h3>ğŸ‘¥ å­¦ç”Ÿåˆ—è¡¨ï¼ˆStudentsï¼‰</h3>
  <table>
    <thead>
      <tr>
        <th>ç”¨æˆ·å</th>
        <th>é‚®ç®±</th>
        <th>ç”µè¯</th>
      </tr>
    </thead>
    <tbody id="studentList"></tbody>
  </table>
</div>

<script>
/* ===============================
   åŠ è½½å­¦ç”Ÿåˆ—è¡¨
=============================== */
async function loadStudents() {
  let res = await fetch(API + "/students");
  let data = await res.json();

  let box = document.getElementById("studentList");
  box.innerHTML = "";

  Object.keys(data).forEach(username => {
    let s = data[username];
    box.innerHTML += `
    <tr>
      <td>${username}</td>
      <td>${s.email || "-"}</td>
      <td>${s.phone || "-"}</td>
    </tr>`;
  });
}

/* ğŸŸ§ åœ¨æœ€åæ‰§è¡Œ loadStudents() */
loadStudents();
</script>
