<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Student Report</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #fffdf7;
    }
    h2 {
      color: #ff8c3a;
    }
    #summaryBox {
      background: white;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<h2>ğŸ“Š å­¦ä¹ æˆç»©æŠ¥å‘Šï¼ˆStudent Reportï¼‰</h2>

<div id="summaryBox">
  <p><b>å­¦ç”Ÿï¼š</b> <span id="studentName"></span></p>
  <p><b>æäº¤æ¬¡æ•°ï¼š</b> <span id="submitCount"></span></p>
</div>

<h3>ğŸ“ˆ å¹³å‡å¾—åˆ†å›¾è¡¨</h3>
<canvas id="scoreChart" width="400" height="250"></canvas>

<script>
const API = "https://lingualisten-backend.onrender.com";

// è·å–ç™»å½•å­¦ç”Ÿ
const username = localStorage.getItem("student_username");
document.getElementById("studentName").innerHTML = username;

// æ‹‰å–æˆç»©æ•°æ®
async function loadReport() {
  let res = await fetch(API + "/reports/user/" + username);
  let data = await res.json();

  document.getElementById("submitCount").innerHTML = data.count;

  let labels = Object.keys(data.average_by_type);
  let scores = Object.values(data.average_by_type);

  // ç”»å›¾
  new Chart(document.getElementById("scoreChart"), {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "å¹³å‡å¾—åˆ†",
        data: scores,
        backgroundColor: "#ff8c3a"
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

loadReport();
</script>

</body>
</html>
