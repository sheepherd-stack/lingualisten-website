<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Student Dashboard</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #fff8f0;
    }
    h2 { color: #ff8c3a; }
    .task {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 14px;
      border: 1px solid #ddd;
    }
    button {
      background: #ff8c3a;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>ğŸ§ Student Dashboard</h2>
<p id="welcome"></p>

<h3>ğŸ“˜ ä½ çš„ä»»åŠ¡åˆ—è¡¨ï¼š</h3>
<div id="taskList">åŠ è½½ä¸­...</div>

<script>
const API = "https://lingualisten-backend.onrender.com";

// ä» localStorage è·å–ç™»å½•ä¿¡æ¯
const username = localStorage.getItem("student_username");
if (!username) {
  alert("æœªç™»å½•ï¼Œè¯·é‡æ–°ç™»å½•");
  location.href = "student_login.html";
}

document.getElementById("welcome").innerHTML = "æ¬¢è¿ä½ ï¼Œ" + username + "ï¼";

// è½½å…¥å±äºå­¦ç”Ÿçš„ä»»åŠ¡
async function loadTasks() {
  let res = await fetch(API + "/assign/" + username);
  let taskIds = await res.json();

  let div = document.getElementById("taskList");

  if (taskIds.length === 0) {
    div.innerHTML = "<p>è€å¸ˆå°šæœªç»™ä½ å¸ƒç½®ä»»åŠ¡ã€‚</p>";
    return;
  }

  div.innerHTML = "";

  // å¾ªç¯è¯»å–æ¯ä¸ªä»»åŠ¡
  for (let id of taskIds) {
    let t = await fetch(API + "/tasks/" + id).then(r => r.json());

    div.innerHTML += `
      <div class="task">
        <h4>${t.title}</h4>
        <p>éš¾åº¦ï¼š${t.difficulty}</p>
        <p>æ¨¡å¼ï¼š${t.modes.join(", ")}</p>
        <button onclick="startTask(${t.id})">å¼€å§‹ä»»åŠ¡</button>
      </div>
    `;
  }
}

function startTask(id) {
  localStorage.setItem("current_task", id);
  location.href = "student_task.html";
}

loadTasks();
</script>

</body>
</html>
