<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å­¦ç”Ÿä¸»é¡µ Student Dashboard</title>
  <style>
    body { font-family: Arial; padding: 20px; background:#fff7ef; }
    h1 { color:#ff7d2d; }
    .task { border:1px solid #ddd; padding:10px; margin:8px 0; border-radius:8px; background:white; }
    button { padding:10px; margin-top:10px; font-size:16px; }
  </style>
</head>
<body>

<h1 id="welcome">LinguaListen Â· å­¦ç”Ÿä¸»é¡µ</h1>

<p>å½“å‰å­¦ç”Ÿï¼š <b id="studentName"></b></p>

<h2>ğŸ“˜ æˆ‘çš„ä»»åŠ¡ My Tasks</h2>
<div id="taskList">åŠ è½½ä¸­ Loading...</div>

<button onclick="goReport()">ğŸ“Š æŸ¥çœ‹å†å²æˆç»© Report</button>

<script>
const API = "https://lingualisten-backend.onrender.com";

// è¯»å–ç™»å½•çš„å­¦ç”Ÿ
const student = localStorage.getItem("student");
if (!student) {
  alert("è¯·å…ˆç™»å½• Please login first");
  window.location.href = "login.html";
}
document.getElementById("studentName").textContent = student;

// åŠ è½½ä»»åŠ¡åˆ—è¡¨ï¼ˆå…ˆç®€åŒ–ï¼šå±•ç¤ºæ‰€æœ‰ä»»åŠ¡ï¼‰
async function loadTasks() {
  const res = await fetch(API + "/tasks/1");  // æš‚æ—¶ä½¿ç”¨ä»»åŠ¡1ä½œç¤ºä¾‹
  if (!res.ok) {
    document.getElementById("taskList").textContent = "æ²¡æœ‰æ‰¾åˆ°ä»»åŠ¡ No tasks";
    return;
  }

  const task = await res.json();
  let html = `
    <div class='task'>
      <h3>${task.title}</h3>
      <p>é¢˜å‹ Modes: ${task.modes.join(", ")}</p>
      <button onclick="startTask(${task.id})">å¼€å§‹ä»»åŠ¡ Start</button>
    </div>
  `;

  document.getElementById("taskList").innerHTML = html;
}

function startTask(id) {
  localStorage.setItem("task_id", id);
  window.location.href = "student_task.html";
}

function goReport() {
  window.location.href = "student_report.html";
}

loadTasks();
</script>

</body>
</html>
